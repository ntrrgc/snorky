/*! Snorky JS connector (bundle) | http://snorkyproject.org/ | MPL License
 *  Includes other software:
 *   - my.class.js | https://github.com/jiem/my-class | MIT License
 *   - js-signals | http://millermedeiros.github.io/js-signals/ | MIT License */
function CycleError(){this.name="CycleError",this.message="Cycles are not allowed"}!function(){var a={};"undefined"!=typeof define?define([],function(){return a}):"undefined"!=typeof window?window.my=a:module.exports=a,a.Class=function(){var a,d,e=arguments.length,f=arguments[e-1],g=e>1?arguments[0]:null,h=e>2;if(f.constructor===Object?a=null===g?function(){}:function(){g.apply(this,arguments)}:(a=f.constructor,delete f.constructor),g&&(d=function(){},d.prototype=g.prototype,a.prototype=new d,a.prototype.constructor=a,a.Super=g,c(a,g,!1)),h)for(var i=1;e-1>i;i++)c(a.prototype,arguments[i].prototype,!1);return b(a,f),a};var b=a.extendClass=function(a,b,d){b.STATIC&&(c(a,b.STATIC,d),delete b.STATIC),c(a.prototype,b,d)},c=function(a,b,c){var d;if(c===!1)for(d in b)d in a||(a[d]=b[d]);else{for(d in b)a[d]=b[d];b.toString!==Object.prototype.toString&&(a.toString=b.toString)}}}(),function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var g,h=e[a],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)k.push("exports"===i[l]?g={}:b(c(i[l])));var n=j.apply(this,k);return f[a]=g||n}}(),a("promise/all",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a){return function(b){f(a,b)}}function f(a,c){h[a]=c,0===--i&&b(h)}var g,h=[],i=a.length;0===i&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&e(g.then)?g.then(d(j),c):f(j,g)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){"use strict";function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new i(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){j.setTimeout(e,1)}}function e(){for(var a=0;a<k.length;a++){var b=k[a],c=b[0],d=b[1];c(d)}k=[]}function f(a,b){var c=k.push([a,b]);1===c&&g()}var g,h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver,j="undefined"!=typeof global?global:void 0===this?window:this,k=[];g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():i?c():d(),a.asap=f}),a("promise/config",["exports"],function(a){"use strict";function b(a,b){return 2!==arguments.length?c[a]:void(c[a]=b)}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){"use strict";function d(){var a;a="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),f(b)}();b||(a.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!v(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],j(a,this)}function j(a,b){function c(a){o(b,a)}function d(a){q(b,a)}try{a(c,d)}catch(e){d(e)}}function k(a,b,c,d){var e,f,g,h,i=v(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;n(b,e)||(i&&g?o(b,e):h?q(b,f):a===D?o(b,e):a===E&&q(b,e))}function l(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+D]=c,e[f+E]=d}function m(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],k(b,c,d,f);a._subscribers=null}function n(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(u(b)&&(d=b.then,v(d)))return d.call(b,function(d){return c?!0:(c=!0,void(b!==d?o(a,d):p(a,d)))},function(b){return c?!0:(c=!0,void q(a,b))}),!0}catch(e){return c?!0:(q(a,e),!0)}return!1}function o(a,b){a===b?p(a,b):n(a,b)||p(a,b)}function p(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(r,a))}function q(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(s,a))}function r(a){m(a,a._state=D)}function s(a){m(a,a._state=E)}var t=a.config,u=(a.configure,b.objectOrFunction),v=b.isFunction,w=(b.now,c.all),x=d.race,y=e.resolve,z=f.reject,A=g.asap;t.async=A;var B=void 0,C=0,D=1,E=2;i.prototype={constructor:i,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;t.async(function(){k(c._state,d,e[c._state-1],c._detail)})}else l(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},i.all=w,i.race=x,i.resolve=y,i.reject=z,h.Promise=i}),a("promise/race",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){"use strict";function b(a){var b=this;return new b(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){"use strict";function b(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){"use strict";function b(a){return c(a)||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}(),function(a){function b(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function c(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function d(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){d.prototype.dispatch.apply(a,arguments)}}b.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},d.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,c,d,e){var f,g=this._indexOfListener(a,d);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else f=new b(this,a,c,d,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,d){return c(a,"add"),this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){return c(a,"addOnce"),this._registerListener(a,!0,b,d)},remove:function(a,b){c(a,"remove");var d=this._indexOfListener(a,b);return-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b,c=Array.prototype.slice.call(arguments),d=this._bindings.length;if(this.memorize&&(this._prevParams=c),d){b=this._bindings.slice(),this._shouldPropagate=!0;do d--;while(b[d]&&this._shouldPropagate&&b[d].execute(c)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var e=d;e.Signal=d,"function"==typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.signals=e}(this),CycleError.prototype=new Error,CycleError.constructor=CycleError;var stableStringify=function(){var a=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},b=Object.keys||function(a){var b=Object.prototype.hasOwnProperty||function(){return!0},c=[];for(var d in a)b.call(a,d)&&c.push(d);return c};return function c(d){var e;if("object"!=typeof d||null===d)return JSON.stringify(d);if(a(d)){if(d.__cycle__)throw new CycleError;d.__cycle__=!0;try{var f=[];for(e=0;e<d.length;e++)f.push(c(d[e]));return"["+f.join(",")+"]"}finally{delete d.__cycle__}}else{if(d.__cycle__)throw new CycleError;d.__cycle__=!0;try{var g=b(d);g.sort();var h=[];for(e=0;e<g.length;e++)if("__cycle__"!=g[e]){var i=JSON.stringify(g[e]),j=c(d[g[e]]);h.push(i+":"+j)}return"{"+h.join(",")+"}"}finally{delete d.__cycle__}}}}(),Snorky=function(a){"use strict";var b={each:function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a)===!1)break},assign:function(a,b){for(var c in b)a[c]=b[c];return a},defaults:function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a},map:function(a,c,d){var e=[];return b.each(a,function(a){e.push(c.call(d,a))}),e},keys:function(a){var b=[];for(var c in a)b.push(c);return b},findIndex:function(a,c,d){var e;return b.each(a,function(a,b){return c.call(d,a)?(e=b,!1):void 0}),e},find:function(a,c,d){var e=b.findIndex(a,c,d);return void 0!==e?a[e]:void 0},remove:function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];b.call(c,f)&&(d.push(f),a.splice(e,1),e--)}return d},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},"in":function(a,c){return b.isArray(a)?-1!=b.indexOf(a,c):c in a},subset:function(a,c,d){d=d||function(){},b.each(a,function(a,e){b["in"](c,e)||d(e,a)})},replace:function(a,c,d,e){var f;return b.each(a,function(b,g){d.call(e,b)&&(a[g]=c,f=b)}),f},field:function(a,b){return function(c){return c[a]==b[a]}},replaceOnField:function(a,c,d){return b.replace(c,d,b.field(a,d))},removeOnField:function(a,c,d){b.remove(c,b.field(a,d))},isEqualRight:function(a,b){for(var c in b)if(a[c]!==b[c])return!1;return!0}},c=new a({constructor:function(a,b,d,e){e=e||{},this.address=b,this.socketClass=a,this.debug=void 0!==e.debug?e.debug:!1,this.services={};for(var f in d){var g=d[f];this.services[f]=new g(f,this)}this._socket=null,this._queuedMessages=[],this.isConnected=!1,this.isConnecting=!1,this.connected=new c.Signal,this.disconnected=new c.Signal,this.connect()},logDebug:function(){if(this.debug&&console&&console.log){var a=console.debug||console.log;if(a.apply)a.apply(console,arguments);else{var b=arguments;a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12])}}},connect:function(){var a=this;this.isConnecting=!0,this._socket=new this.socketClass(this.address),this._socket.onopen=function(){a._onSocketOpen()},this._socket.onmessage=function(b){a._onSocketMessage(b)},this._socket.onclose=function(){a._onSocketClose()}},disconnect:function(){this._socket.close(),this.isConnected=!1},_onSocketOpen:function(){this.logDebug("Connected to Snorky server."),this.isConnected=!0,this.isConnecting=!1,this.connected.dispatch(),b.each(this._queuedMessages,function(a){this._socket.send(a)},this),this._queuedMessages=[]},_onSocketMessage:function(a){var b=a.data,c=JSON.parse(b),d=c.service;d in this.services&&this.services[d].packetReceived.dispatch(c.message)},_onSocketClose:function(){this.logDebug("Snorky disconnected"),this.isConnected=!1,this.isConnecting=!1,this.disconnected.dispatch(),this._socket=null},_sendServiceMessage:function(a,b){var c=JSON.stringify({service:a,message:b});this.isConnected?this._socket.send(c):this._queuedMessages.push(c)}});return c.Class=a,c._=b,"undefined"!=typeof signals&&(c.Signal=signals.Signal),c.Promise=Promise,c}(my.Class);!function(){"use strict";var a=Snorky.Class,b=Snorky._;Snorky.Service=new a({constructor:function(a,b){if(!a instanceof String||!b)throw Error("Bad arguments for service constructor");this.name=a,this.snorky=b,this.packetReceived=new Snorky.Signal,this.init()},init:function(){},sendMessage:function(a){this.snorky._sendServiceMessage(this.name,a)}}),Snorky.RPCService=new a(Snorky.Service,{init:function(){this.nextCallId=0,this.calls={},this.packetReceived.add(this.onPacket,this),this.notificationReceived=new Snorky.Signal},rpcCall:function(a,b){var c=this;return new Snorky.Promise(function(d,e){var f=c.nextCallId++;c.calls[f]={resolve:d,reject:e},c.sendMessage({command:a,params:b,callId:f})})},onPacket:function(a){return"type"in a?"response"!=a.type&&"error"!=a.type||a.callId in this.calls?void("response"==a.type?this.calls[a.callId].resolve(a.data):"error"==a.type?this.calls[a.callId].reject(Error(a.message)):this.notificationReceived.dispatch(a)):void console.error('Response for unknown call with id "%s" from service "%s"',a.callId,this.name):void console.error('Non-RPC message received from service "%s"',this.name)},STATIC:{addRPCMethods:function(a){var c=this;b.each(a,function(a){if(a in c.prototype)throw Error('Method "'+a+'" already exists in the class. Refusing to overwrite it.');c.prototype[a]=function(b){return this.rpcCall(a,b||{})}})}}})}(),function(){"use strict";var a=Snorky.Class;Snorky.Messaging=new a(Snorky.RPCService,{init:function(){Snorky.RPCService.prototype.init.call(this),this.notificationReceived.add(this.onNotification,this),this.messageReceived=new Snorky.Signal},onNotification:function(a){"message"==a.type?this.messageReceived.dispatch(a):console.error("Unknown message type in messaging service: "+a.type)}}),Snorky.Messaging.addRPCMethods(["registerParticipant","unregisterParticipant","listParticipants","send"])}(),function(){"use strict";var a=Snorky.Class;Snorky.PubSub=new a(Snorky.RPCService,{init:function(){Snorky.RPCService.prototype.init.call(this),this.notificationReceived.add(this.onNotification),this.messagePublished=new Snorky.Signal},onNotification:function(a){"message"==a.type?this.messagePublished.dispatch(a):console.error("Unknown message type in messaging service: "+a.type)}}),Snorky.PubSub.addRPCMethods(["publish","subscribe","unsubscribe"])}(),function(){"use strict";var a=Snorky.Class,b=Snorky._;Snorky.DataSync=new a(Snorky.RPCService,{init:function(){Snorky.RPCService.prototype.init.call(this),this.notificationReceived.add(this.onNotification,this),this.deltaReceived=new Snorky.Signal},onNotification:function(a){"delta"==a.type?this.deltaReceived.dispatch(a.delta):console.error("Unknown message type in DataSync service: "+a.type)}}),Snorky.DataSync.addRPCMethods(["acquireSubscription","cancelSubscription"]);{var c=(Snorky.DataSync.CollectionDeltaProcessor=new a({constructor:function(a,b){this.collections=a||{},b=b||{},b.itemsAreEqual&&(this.itemsAreEqual=b.itemsAreEqual)},itemsAreEqual:function(a,b,c){return a.id==b.id},processDelta:function(a){var b,c,d;if(!(a.model in this.collections))return void(console&&console.error&&console.error("Received delta for unregistered model: "+a.model));if(this.collections[a.model]instanceof Snorky.DataSync.Collection)b=this.collections[a.model];else{if(!(a.tag in this.collections[a.model]))return void(console&&console.error&&console.error("Received delta with unregistered tag: "+a.tag+" (model: "+a.model+")"));b=this.collections[a.model][a.tag]}if("insert"==a.type)b.insert(a.data);else if("update"==a.type){for(c=b.getIterator();c.hasNext();)if(d=c.next(),this.itemsAreEqual(d,a.oldData)){c.update(a.newData);break}}else if("delete"==a.type){for(c=b.getIterator();c.hasNext();)if(d=c.next(),this.itemsAreEqual(d,a.data)){c.remove();break}}else console&&console.error&&console.error("Received delta of strange type: "+a.type)}}),Snorky.DataSync.Collection=new a({})),d=Snorky.DataSync.ArrayIterator=new a({constructor:function(a,b){this.array=a,this.options=b},array:null,index:-1,deleted:!1,options:{},hasNext:function(){var a=this.array.length-1;return this.index<a},next:function(){if(!this.hasNext())throw new Error("Busted iterator");return this.deleted=!1,this.array[++this.index]},checkSafe:function(){if(this.deleted)throw new Error("Iterator pointing to a deleted item! (call next())");if(-1==this.index)throw new Error("Iterator not pointing to an item! (call next())")},remove:function(){this.checkSafe(),this.array.splice(this.index--,1),this.deleted=!0},update:function(a){this.checkSafe(),this.array[this.index]=this.options.transformItem(a)}}),e=(Snorky.DataSync.ArrayCollection=new a(c,{constructor:function(a,c){this.array=a,this.options=b.defaults(c,{transformItem:function(a){return a}})},array:null,options:{},insert:function(a){var b=this.options.transformItem(a);this.array.push(b)},getIterator:function(){return new d(this.array,this.options)}}),Snorky.DataSync.SingleItemIterator=new a({constructor:function(a){this.fetched=!1,this.collection=a},fetched:!1,collection:null,hasNext:function(){return!this.fetched},next:function(){if(this.fetched)throw new Error("Busted iterator");return this.fetched=!0,this.collection.readHandler()},remove:function(){if(!this.fetched)throw new Error("Iterator not pointing to an item! (call next())");this.collection.removeHandler()},update:function(a){if(!this.fetched)throw new Error("Iterator not pointing to an item! (call next())");this.collection.updateHandler(a)}}));Snorky.DataSync.SingleItemCollection=new a(c,{constructor:function(a,b,c){this.readHandler=a,this.updateHandler=b,this.removeHandler=c||function(){}},item:null,insert:function(a){console&&console.error&&console.error("Received insert() request in SingleItemCollection")},getIterator:function(){return new e(this)}})}}(),function(){"use strict";var a=Snorky.Class;Snorky.Chat=new a(Snorky.RPCService,{init:function(){Snorky.RPCService.prototype.init.call(this),this.notificationReceived.add(this.onNotification,this),this.messageReceived=new Snorky.Signal,this.presenceReceived=new Snorky.Signal,this.readReceived=new Snorky.Signal},onNotification:function(a){"message"==a.type?this.messageReceived.dispatch(a):"presence"==a.type?this.presenceReceived.dispatch(a):"read"==a.type?this.readReceived.dispatch(a):console.error("Unknown message type in messaging service: "+a.type)}}),Snorky.Chat.addRPCMethods(["join","leave","send","read"])}(),function(){"use strict";var a=Snorky.Class,b=Snorky._,c=new a({}),d=new a(c,{constructor:function(a){b.assign(this,a)},isMine:!1}),e=new a(c,{constructor:function(a,c){this.document=a,this.removed=!1,b.assign(this,c),this.pendingPromiseCount=1},isMine:!0,update:function(a){var c=this,d=this.document.service;return c.pendingPromiseCount+=1,b.subset(a,["position","status"],function(a){throw new Error("Can't update '"+a+"' of cursor.")}),b.isEqualRight(this,a)?new Promise(function(a){a()}):(b.assign(this,a),d.rpcCall("updateCursor",{privateHandle:this.privateHandle,newData:a}).then(function(){c.pendingPromiseCount-=1}))},remove:function(){var a=this,c=this.document.service;return a.pendingPromiseCount+=1,a.removed=!0,delete c.ownCursors[a.privateHandle],b.removeOnField("privateHandle",this.document.cursors,this.privateHandle),c.rpcCall("removeCursor",{privateHandle:this.privateHandle}).then(function(){a.pendingPromiseCount-=1})},isSynchronized:function(){return 0===this.pendingPromiseCount}}),f=new a({constructor:function(a,c,e){this.service=a,this.name=c,this.cursors=b.map(e,function(a){return a.document=this,new d(a)},this),this.cursorAdded=new Snorky.Signal,this.cursorUpdated=new Snorky.Signal,this.cursorRemoved=new Snorky.Signal},onCursorAdded:function(a){var b=new d(a);this.cursors.push(b),this.cursorAdded.dispatch(b)},onCursorUpdated:function(a){var c=b.replaceOnField("publicHandle",this.cursors,a);this.cursorUpdated.dispatch(c)},onCursorRemoved:function(a){b.removeOnField("publicHandle",this.cursors,a),this.cursorRemoved.dispatch(a)},createCursor:function(a){var b=this.service.getFreePrivateHandle(),c=new Snorky.Cursors.OwnCursor(this,{privateHandle:b,position:a.position,status:a.status}),d=this.service.rpcCall("createCursor",{privateHandle:b,document:this.name,position:a.position,status:a.status}).then(function(a){c.publicHandle=a,c.pendingPromiseCount-=1});return this.service.ownCursors[b]=c,this.cursors.push(c),[c,d]}});Snorky.Cursors=new a(Snorky.RPCService,{init:function(){Snorky.RPCService.prototype.init.call(this),this.notificationReceived.add(this.onNotification,this),this.documents={},this.ownCursors={}},join:function(a){var b=this;return this.rpcCall("join",a).then(function(c){var d=a.document,e=new Snorky.Cursors.Document(b,d,c.cursors);return b.documents[stableStringify(d)]=e,e})},onNotification:function(a){var b=a.cursor,c=this.documents[stableStringify(b.document)];if(!c)throw Error("Notification for unknown document: "+stableStringify(a.document));"cursorAdded"==a.type?c.onCursorAdded(b):"cursorUpdated"==a.type?c.onCursorUpdated(b):"cursorRemoved"==a.type&&c.onCursorRemoved(b)},getFreePrivateHandle:function(){if(b.keys(this.ownCursors).length>100)throw new Error("Too many cursors (thrown at client side)");var a;do a=Math.round(255*Math.random());while(a in this.ownCursors);return a}}),Snorky.Cursors.Document=f,Snorky.Cursors.Cursor=c,Snorky.Cursors.ForeignCursor=d,Snorky.Cursors.OwnCursor=e}();
//# sourceMappingURL=snorky.bundle.min.js.map